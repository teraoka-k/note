{"ast":null,"code":"import { MongoClient } from 'mongodb';\nconst URL = 'mongodb://localhost:27017';\nconst NAME = 'mongodb';\nexport async function insertDocument(collectionName, document) {\n  let client;\n\n  try {\n    client = await MongoClient.connect(URL, {\n      useNewUrlParser: true\n    });\n    await client.db(NAME).collection(collectionName).insertOne(document);\n  } finally {\n    client.close();\n  }\n}\nexport async function findDocuments(collectionName, filter) {\n  return await test(collectionName, async collection => await collection.find(filter).toArray());\n}\nexport async function deleteDocument(collectionName, filter) {\n  let client;\n\n  try {\n    client = await MongoClient.connect(URL, {\n      useNewUrlParser: true\n    });\n    return await client.db(NAME).collection(collectionName).deleteOne(filter);\n  } finally {\n    client.close();\n  }\n}\nexport async function updateDocument(collectionName, filter, newDocument) {\n  let client;\n\n  try {\n    client = await MongoClient.connect(URL, {\n      useNewUrlParser: true\n    });\n    return await client.db(NAME).collection(collectionName).updateOne(filter, {\n      $set: newDocument\n    });\n  } finally {\n    client.close();\n  }\n}\n\nasync function test(collectionName, method) {\n  let client;\n\n  try {\n    client = await MongoClient.connect(URL, {\n      useNewUrlParser: true\n    });\n    const collection = client.db(NAME).collection(collectionName);\n    return await method(collection);\n  } finally {\n    client.close();\n  }\n}","map":{"version":3,"sources":["/home/teraoka/app/note/logic/mongoAPI.ts"],"names":["MongoClient","URL","NAME","insertDocument","collectionName","document","client","connect","useNewUrlParser","db","collection","insertOne","close","findDocuments","filter","test","find","toArray","deleteDocument","deleteOne","updateDocument","newDocument","updateOne","$set","method"],"mappings":"AAAA,SAASA,WAAT,QAAwC,SAAxC;AAEA,MAAMC,GAAG,GAAG,2BAAZ;AACA,MAAMC,IAAI,GAAG,SAAb;AAEA,OAAO,eAAeC,cAAf,CACLC,cADK,EAELC,QAFK,EAGU;AACf,MAAIC,MAAJ;;AACA,MAAI;AACFA,IAAAA,MAAM,GAAG,MAAMN,WAAW,CAACO,OAAZ,CAAoBN,GAApB,EAAyB;AAAEO,MAAAA,eAAe,EAAE;AAAnB,KAAzB,CAAf;AACA,UAAMF,MAAM,CAACG,EAAP,CAAUP,IAAV,EAAgBQ,UAAhB,CAA2BN,cAA3B,EAA2CO,SAA3C,CAAqDN,QAArD,CAAN;AACD,GAHD,SAGU;AACRC,IAAAA,MAAM,CAACM,KAAP;AACD;AACF;AAED,OAAO,eAAeC,aAAf,CACLT,cADK,EAELU,MAFK,EAGW;AAChB,SAAO,MAAMC,IAAI,CACfX,cADe,EAEf,MAAOM,UAAP,IACE,MAAMA,UAAU,CAACM,IAAX,CAAgBF,MAAhB,EAAwBG,OAAxB,EAHO,CAAjB;AAKD;AAED,OAAO,eAAeC,cAAf,CAA8Bd,cAA9B,EAAsDU,MAAtD,EAAsE;AAC3E,MAAIR,MAAJ;;AACA,MAAI;AACFA,IAAAA,MAAM,GAAG,MAAMN,WAAW,CAACO,OAAZ,CAAoBN,GAApB,EAAyB;AAAEO,MAAAA,eAAe,EAAE;AAAnB,KAAzB,CAAf;AACA,WAAO,MAAMF,MAAM,CAACG,EAAP,CAAUP,IAAV,EAAgBQ,UAAhB,CAA2BN,cAA3B,EAA2Ce,SAA3C,CAAqDL,MAArD,CAAb;AACD,GAHD,SAGU;AACRR,IAAAA,MAAM,CAACM,KAAP;AACD;AACF;AAED,OAAO,eAAeQ,cAAf,CACLhB,cADK,EAELU,MAFK,EAGLO,WAHK,EAIL;AACA,MAAIf,MAAJ;;AACA,MAAI;AACFA,IAAAA,MAAM,GAAG,MAAMN,WAAW,CAACO,OAAZ,CAAoBN,GAApB,EAAyB;AAAEO,MAAAA,eAAe,EAAE;AAAnB,KAAzB,CAAf;AACA,WAAO,MAAMF,MAAM,CAChBG,EADU,CACPP,IADO,EAEVQ,UAFU,CAECN,cAFD,EAGVkB,SAHU,CAGAR,MAHA,EAGQ;AAAES,MAAAA,IAAI,EAAEF;AAAR,KAHR,CAAb;AAID,GAND,SAMU;AACRf,IAAAA,MAAM,CAACM,KAAP;AACD;AACF;;AAED,eAAeG,IAAf,CACEX,cADF,EAEEoB,MAFF,EAGE;AACA,MAAIlB,MAAJ;;AACA,MAAI;AACFA,IAAAA,MAAM,GAAG,MAAMN,WAAW,CAACO,OAAZ,CAAoBN,GAApB,EAAyB;AAAEO,MAAAA,eAAe,EAAE;AAAnB,KAAzB,CAAf;AACA,UAAME,UAAU,GAAGJ,MAAM,CAACG,EAAP,CAAUP,IAAV,EAAgBQ,UAAhB,CAA2BN,cAA3B,CAAnB;AACA,WAAO,MAAMoB,MAAM,CAACd,UAAD,CAAnB;AACD,GAJD,SAIU;AACRJ,IAAAA,MAAM,CAACM,KAAP;AACD;AACF","sourcesContent":["import { MongoClient, Collection } from 'mongodb'\n\nconst URL = 'mongodb://localhost:27017'\nconst NAME = 'mongodb'\n\nexport async function insertDocument(\n  collectionName: string,\n  document: object\n): Promise<void> {\n  let client: MongoClient\n  try {\n    client = await MongoClient.connect(URL, { useNewUrlParser: true })\n    await client.db(NAME).collection(collectionName).insertOne(document)\n  } finally {\n    client.close()\n  }\n}\n\nexport async function findDocuments(\n  collectionName: string,\n  filter: object\n): Promise<any[]> {\n  return await test(\n    collectionName,\n    async (collection: Collection<any>) =>\n      await collection.find(filter).toArray()\n  )\n}\n\nexport async function deleteDocument(collectionName: string, filter: object) {\n  let client: MongoClient\n  try {\n    client = await MongoClient.connect(URL, { useNewUrlParser: true })\n    return await client.db(NAME).collection(collectionName).deleteOne(filter)\n  } finally {\n    client.close()\n  }\n}\n\nexport async function updateDocument(\n  collectionName: string,\n  filter: object,\n  newDocument: object\n) {\n  let client: MongoClient\n  try {\n    client = await MongoClient.connect(URL, { useNewUrlParser: true })\n    return await client\n      .db(NAME)\n      .collection(collectionName)\n      .updateOne(filter, { $set: newDocument })\n  } finally {\n    client.close()\n  }\n}\n\nasync function test(\n  collectionName: string,\n  method: (collection: Collection<any>) => Promise<any>\n) {\n  let client: MongoClient\n  try {\n    client = await MongoClient.connect(URL, { useNewUrlParser: true })\n    const collection = client.db(NAME).collection(collectionName)\n    return await method(collection)\n  } finally {\n    client.close()\n  }\n}\n"]},"metadata":{},"sourceType":"module"}